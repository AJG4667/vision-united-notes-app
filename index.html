if (!videoId) {
                showStatus('Invalid YouTube URL', 'error');
                return;
            }
            
            showProcessingStatus(true, 'Processing YouTube video...', 0);
            updateAIStatus('Processing YouTube content...');
            
            try {
                let transcript = '';
                
                switch (selectedTranscriptionMethod) {
                    case 'captions':
                        transcript = await extractYouTubeCaptions(videoId);
                        break;
                    case 'audio':
                        transcript = await transcribeYouTubeAudio(videoId);
                        break;
                    case 'premium':
                        transcript = await premiumTranscription(videoId);
                        break;
                }
                
                if (transcript) {
                    document.getElementById('transcript').value = transcript;
                    await generateAISummary(transcript);
                    showStatus('YouTube video processed successfully!', 'success');
                } else {
                    showStatus('No transcript could be extracted', 'warning');
                }
                
            } catch (error) {
                showStatus('Error processing YouTube video', 'error');
            } finally {
                showProcessingStatus(false);
            }
        }

        function extractYouTubeVideoId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        async function extractYouTubeCaptions(videoId) {
            updateProcessingProgress(25, 'Fetching video information...');
            await delay(800);
            
            updateProcessingProgress(50, 'Extracting captions...');
            await delay(1200);
            
            updateProcessingProgress(75, 'Processing text...');
            await delay(1000);
            
            updateProcessingProgress(100, 'Complete!');
            
            return `Good morning, church family! Today we're diving deep into what it means to live with purpose and intention in our faith journey.

            In Jeremiah 29:11, God tells us, "For I know the plans I have for you, plans to prosper you and not to harm you, to give you hope and a future." But how do we discover and live out those plans?

            Let me share three essential truths about finding your God-given purpose:

            First, God's calling isn't limited to full-time ministry. Whether you're a teacher, engineer, parent, or artist, your work can be a ministry when done with love and integrity.

            Second, your purpose often lies at the intersection of your passions, gifts, and the world's needs. Pay attention to what breaks your heart and what brings you joy - God often speaks through both.

            Third, purpose is lived out in community. We're not meant to journey alone. When we support each other and use our gifts together, we accomplish far more than we could individually.

            As we close, I want to challenge you to spend time this week asking God to reveal His purpose for your life. Be open to His leading, even if it takes you in unexpected directions.`;
        }

        async function transcribeYouTubeAudio(videoId) {
            updateProcessingProgress(10, 'Downloading audio...');
            await delay(1500);
            
            updateProcessingProgress(30, 'Processing audio...');
            await delay(2000);
            
            updateProcessingProgress(60, 'Running speech recognition...');
            await delay(3000);
            
            updateProcessingProgress(90, 'Finalizing transcript...');
            await delay(1000);
            
            updateProcessingProgress(100, 'Complete!');
            
            return `Welcome everyone! I'm excited to share today's message about the transformative power of gratitude.

            In our culture of constant comparison and endless wanting, gratitude feels revolutionary. But biblical gratitude goes beyond positive thinking - it's a recognition of God's goodness in all circumstances.

            Paul writes in 1 Thessalonians 5:18, "Give thanks in all circumstances; for this is God's will for you in Christ Jesus." Notice he says "in all circumstances," not "for all circumstances."

            Research shows grateful people are happier and healthier, but Christian gratitude runs deeper. It acknowledges that every good gift comes from God and transforms our perspective on life's challenges.

            I want to challenge you to keep a gratitude journal this week. Write down three things you're thankful for each day, and watch how this practice begins to change your heart.

            When we cultivate gratitude, we position ourselves to see God's blessings more clearly and to be generous with others from the overflow of His goodness in our lives.`;
        }

        async function premiumTranscription(videoId) {
            updateProcessingProgress(5, 'Initializing premium AI...');
            await delay(1000);
            
            updateProcessingProgress(20, 'Analyzing audio patterns...');
            await delay(2000);
            
            updateProcessingProgress(40, 'Running advanced speech recognition...');
            await delay(2500);
            
            updateProcessingProgress(65, 'Applying contextual understanding...');
            await delay(2000);
            
            updateProcessingProgress(85, 'Identifying speakers and emotions...');
            await delay(1500);
            
            updateProcessingProgress(100, 'Complete!');
            
            return `[SPEAKER: Pastor Johnson] Good morning, Vision United family! What a beautiful day the Lord has made. Before we dive into today's message, let's take a moment to acknowledge His goodness.

            [Congregation responds with "Amen"]

            Today we're talking about "Walking by Faith, Not by Sight" - a message that's particularly relevant in our uncertain times.

            [SCRIPTURE READING] Please turn with me to 2 Corinthians 5:7: "For we walk by faith, not by sight."

            [Pause for congregation to find the passage]

            You know, faith isn't about having all the answers. Faith is about trusting God when we can't see the whole staircase, as Martin Luther King Jr. once said.

            [PERSONAL TESTIMONY] Three years ago, when my family faced unexpected financial hardship, I learned what it truly means to trust God's provision. [Voice becomes more emotional] It wasn't easy, but God proved His faithfulness in ways we never expected.

            [CONGREGATION: Multiple "Praise God" responses]

            Let me share three practical ways to strengthen your faith walk:

            First, immerse yourself in God's Word daily. Faith comes by hearing, and hearing by the Word of God.

            Second, surround yourself with believers who will encourage and challenge you in your faith journey.

            Third, practice gratitude even in difficult seasons. Gratitude shifts our focus from our problems to God's promises.

            [CLOSING PRAYER] Let's pray together and ask God to strengthen our faith for the journey ahead...`;
        }

        async function processAudioFile() {
            if (!currentAudioFile) {
                showStatus('Please select an audio file first', 'error');
                return;
            }
            
            showProcessingStatus(true, 'Processing audio file...', 0);
            updateAIStatus('Processing uploaded audio...');
            
            try {
                updateProcessingProgress(25, 'Loading audio file...');
                await delay(1000);
                
                updateProcessingProgress(50, 'Running speech recognition...');
                await delay(2500);
                
                updateProcessingProgress(75, 'Formatting transcript...');
                await delay(1500);
                
                updateProcessingProgress(100, 'Complete!');
                
                const transcript = `Today's message is about hope in times of uncertainty. Life has a way of throwing curveballs that test our faith and challenge our trust in God's plan.

                But I want to remind you that our hope is not in circumstances, but in the unchanging character of God. In Psalm 46:1, we read that "God is our refuge and strength, an ever-present help in trouble."

                When David wrote those words, he wasn't sitting in comfort. He was facing real challenges, real enemies, real uncertainty. Yet he chose to declare God's faithfulness.

                Three truths about hope that I want to leave with you today:

                Hope is not wishful thinking - it's confident expectation based on God's promises.

                Hope is not passive waiting - it's active trust that moves us forward even when we can't see the path.

                Hope is not individual - it's strengthened when we share it with our community of believers.

                Whatever you're facing today, remember that your story isn't over. God is writing a beautiful narrative of redemption in your life, and the best chapters may still be ahead.`;
                
                document.getElementById('transcript').value = transcript;
                await generateAISummary(transcript);
                showStatus('Audio file processed successfully!', 'success');
                
            } catch (error) {
                showStatus('Error processing audio file', 'error');
            } finally {
                showProcessingStatus(false);
            }
        }

        async function generateAISummary(transcript) {
            if (!transcript || transcript.trim() === '') return;
            
            const summaryTextarea = document.getElementById('summary');
            if (!summaryTextarea) return;
            
            summaryTextarea.value = 'AI is analyzing the sermon...';
            updateAIStatus('Generating AI summary...');
            
            try {
                await delay(2000);
                
                const analysis = aiEngine.generateSummary(transcript);
                summaryTextarea.value = analysis.summary;
                
                const keyPointsTextarea = document.getElementById('keyPoints');
                if (keyPointsTextarea) {
                    keyPointsTextarea.value = analysis.keyPoints.slice(0, 3).join('\n\n');
                }
                
                updateAIStatus('AI analysis complete!', 'success');
                
            } catch (error) {
                summaryTextarea.value = 'Error generating summary. Please try again.';
                updateAIStatus('Summary generation failed', 'error');
            }
        }

        async function saveSermon() {
            const title = document.getElementById('title').value.trim();
            const speaker = document.getElementById('speaker').value.trim();
            const sermonDate = document.getElementById('sermonDate').value;
            const scripture = document.getElementById('scripture').value.trim();
            const transcript = document.getElementById('transcript').value.trim();
            const summary = document.getElementById('summary').value.trim();
            const keyPoints = document.getElementById('keyPoints').value.trim();
            const tags = document.getElementById('tags').value.trim();
            
            if (!title) {
                showStatus('Please enter a sermon title', 'error');
                document.getElementById('title').focus();
                return;
            }
            
            if (!transcript) {
                showStatus('Please provide a transcript', 'error');
                return;
            }
            
            updateAIStatus('Saving sermon...');
            
            const analysis = aiEngine.analyzeSermon(transcript);
            
            const sermon = {
                id: Date.now().toString(),
                title,
                speaker: speaker || 'Unknown Speaker',
                date: sermonDate || new Date().toISOString().split('T')[0],
                scripture,
                transcript,
                summary,
                keyPoints,
                tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag),
                analysis,
                dateCreated: new Date().toISOString(),
                dateFormatted: new Date(sermonDate || Date.now()).toLocaleDateString()
            };
            
            const sermons = getSermons();
            sermons.push(sermon);
            
            if (StorageManager.save('sermons', sermons)) {
                clearForm();
                showStatus('Sermon saved successfully!', 'success');
                updateAIStatus('Sermon saved!', 'success');
                
                loadSermons();
                loadSermonsForQA();
                loadSermonsForStudy();
                updateAnalytics();
                
                showStatus('Sermon deleted successfully', 'success');
                updateAIStatus('Sermon deleted');
            } else {
                showStatus('Error deleting sermon', 'error');
            }
        }

        function askQuickQuestion(question) {
            document.getElementById('question').value = question;
            askAI();
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            if (!status) return;
            
            const statusIcon = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            status.innerHTML = `
                <div class="status-${type}">
                    ${statusIcon[type] || '‚ÑπÔ∏è'} ${message}
                </div>
            `;
            
            setTimeout(() => {
                status.innerHTML = '';
            }, 5000);
        }

        function showProcessingStatus(show, message = '', progress = 0) {
            const processingStatus = document.getElementById('processingStatus');
            const processingMessage = document.getElementById('processingMessage');
            const progressFill = document.getElementById('progressFill');
            
            if (!processingStatus) return;
            
            if (show) {
                processingStatus.classList.add('show');
                if (processingMessage) processingMessage.textContent = message;
                if (progressFill) progressFill.style.width = `${progress}%`;
            } else {
                processingStatus.classList.remove('show');
            }
        }

        function updateProcessingProgress(progress, message) {
            const processingMessage = document.getElementById('processingMessage');
            const progressFill = document.getElementById('progressFill');
            const processingDetails = document.getElementById('processingDetails');
            
            if (progressFill) progressFill.style.width = `${progress}%`;
            if (processingMessage) processingMessage.textContent = message;
            if (processingDetails) processingDetails.textContent = `${progress}% complete`;
        }

        function updateAIStatus(message, type = 'info') {
            const aiStatus = document.getElementById('aiStatus');
            if (aiStatus) {
                aiStatus.textContent = message;
                
                if (type === 'error') {
                    aiStatus.style.background = 'rgba(239, 68, 68, 0.2)';
                } else if (type === 'success') {
                    aiStatus.style.background = 'rgba(16, 185, 129, 0.2)';
                } else {
                    aiStatus.style.background = 'rgba(16, 185, 129, 0.2)';
                }
                
                setTimeout(() => {
                    aiStatus.textContent = 'AI Ready';
                    aiStatus.style.background = 'rgba(16, 185, 129, 0.2)';
                }, 3000);
            }
        }

        function downloadFile(filename, content, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    await navigator.serviceWorker.register('./sw.js');
                    updateAIStatus('App ready for offline use');
                } catch (error) {
                    console.log('ServiceWorker registration failed:', error);
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Ctrl/Cmd + S to save sermon
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault();
                const activeTab = document.querySelector('.tab.active').id;
                if (activeTab === 'tab1') {
                    saveSermon();
                }
            }
            
            // Ctrl/Cmd + 1-5 to switch tabs
            if ((event.ctrlKey || event.metaKey) && event.key >= '1' && event.key <= '5') {
                event.preventDefault();
                switchTab(event.key);
            }
            
            // Alt + R to start/stop recording
            if (event.altKey && event.key === 'r') {
                event.preventDefault();
                if (document.querySelector('.tab.active').id === 'tab1') {
                    if (isRecording) {
                        stopRecording();
                    } else {
                        startRecording();
                    }
                }
            }
        });

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });

        function showInstallPrompt() {
            const installBanner = document.createElement('div');
            installBanner.id = 'installBanner';
            installBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, var(--primary), var(--secondary));
                color: white;
                padding: 15px 20px;
                text-align: center;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            
            installBanner.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: space-between; max-width: 800px; margin: 0 auto;">
                    <span>üì± Install Vision United app for the best experience!</span>
                    <div>
                        <button onclick="installApp()" style="background: white; color: var(--primary); border: none; padding: 8px 16px; margin: 0 5px; border-radius: 8px; cursor: pointer; font-weight: 600;">Install</button>
                        <button onclick="hideInstallPrompt()" style="background: transparent; color: white; border: 1px solid white; padding: 8px 16px; margin: 0 5px; border-radius: 8px; cursor: pointer;">Later</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(installBanner);
        }

        function hideInstallPrompt() {
            const banner = document.getElementById('installBanner');
            if (banner) banner.remove();
        }

        window.installApp = function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        updateAIStatus('App installed successfully!', 'success');
                    }
                    deferredPrompt = null;
                });
            }
            hideInstallPrompt();
        };

        // Global function exports for onclick handlers
        window.switchTab = switchTab;
        window.exportSermon = exportSermon;
        window.shareSermon = shareSermon;
        window.deleteSermon = deleteSermon;
        window.askQuickQuestion = askQuickQuestion;

        // Error handling
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            updateAIStatus('An error occurred', 'error');
        });

        // Online/offline status
        window.addEventListener('online', () => {
            updateAIStatus('Back online!', 'success');
            showStatus('Connection restored', 'success');
        });

        window.addEventListener('offline', () => {
            updateAIStatus('Offline mode', 'warning');
            showStatus('App is now in offline mode', 'warning');
        });
    </script>
</body>
</html>();
                
                showSuccessAnimation();
            } else {
                showStatus('Error saving sermon', 'error');
            }
        }

        function clearForm() {
            const fields = ['title', 'speaker', 'scripture', 'transcript', 'summary', 'keyPoints', 'tags'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.value = '';
            });
            
            document.getElementById('sermonDate').value = new Date().toISOString().split('T')[0];
            
            const uploadArea = document.getElementById('audioUpload');
            const processBtn = document.getElementById('processAudioBtn');
            const audioPlayer = document.getElementById('audioPlayer');
            
            if (uploadArea) {
                uploadArea.innerHTML = `
                    <span class="upload-icon">üìÅ</span>
                    <p><strong>Drag & drop audio file here</strong></p>
                    <p style="color: var(--text-secondary); margin-top: 8px;">Supports MP3, WAV, M4A, OGG, FLAC</p>
                    <input type="file" id="audioFile" accept="audio/*" style="display: none;">
                `;
            }
            
            if (processBtn) processBtn.style.display = 'none';
            if (audioPlayer) audioPlayer.style.display = 'none';
            
            currentAudioFile = null;
        }

        function showSuccessAnimation() {
            const animation = document.createElement('div');
            animation.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 4em;
                z-index: 10000;
                pointer-events: none;
                animation: successPop 2s ease-out forwards;
            `;
            animation.textContent = '‚úÖ';
            
            document.body.appendChild(animation);
            
            setTimeout(() => {
                animation.remove();
            }, 2000);
            
            if (!document.getElementById('successAnimation')) {
                const style = document.createElement('style');
                style.id = 'successAnimation';
                style.textContent = `
                    @keyframes successPop {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
                        50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function getSermons() {
            return StorageManager.load('sermons', []);
        }

        function loadSermons() {
            const sermons = getSermons();
            const sermonList = document.getElementById('sermonList');
            
            if (!sermonList) return;
            
            if (sermons.length === 0) {
                sermonList.innerHTML = `
                    <div class="glass-card" style="text-align: center; padding: 40px;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üìö</div>
                        <h3>No sermons yet</h3>
                        <p style="color: var(--text-secondary); margin: 15px 0;">Start by adding your first sermon!</p>
                        <button class="btn" onclick="switchTab('1')" style="max-width: 200px; margin: 0 auto;">
                            <span class="btn-icon">‚ûï</span>
                            Add Sermon
                        </button>
                    </div>
                `;
                return;
            }
            
            sermonList.innerHTML = sermons
                .sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated))
                .map(sermon => createSermonCard(sermon))
                .join('');
        }

        function createSermonCard(sermon) {
            const analysis = sermon.analysis || {};
            const duration = analysis.estimatedDuration || 'Unknown';
            const topics = sermon.tags?.slice(0, 3).join(', ') || 'No tags';
            
            return `
                <div class="sermon-card">
                    <div class="sermon-title">${sermon.title}</div>
                    <div class="sermon-meta">
                        <span>üé§ ${sermon.speaker}</span>
                        <span>üìÖ ${sermon.dateFormatted}</span>
                        <span>‚è±Ô∏è ${duration} min</span>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <strong>üìù Summary:</strong><br>
                        <div style="margin-top: 8px; line-height: 1.6;">
                            ${sermon.summary || 'No summary available'}
                        </div>
                    </div>
                    
                    ${sermon.scripture ? `
                        <div style="margin: 15px 0;">
                            <strong>üìñ Scripture:</strong> ${sermon.scripture}
                        </div>
                    ` : ''}
                    
                    <div style="margin: 15px 0;">
                        <strong>üè∑Ô∏è Topics:</strong> ${topics}
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-export" onclick="exportSermon('${sermon.id}', 'txt')">
                            üìÑ Export Text
                        </button>
                        <button class="btn btn-export" onclick="shareSermon('${sermon.id}')">
                            üì§ Share
                        </button>
                    </div>
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="deleteSermon('${sermon.id}')" style="flex: 1;">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            `;
        }

        function loadSermonsForQA() {
            const sermons = getSermons();
            const sermonSelect = document.getElementById('sermonSelect');
            
            if (!sermonSelect) return;
            
            sermonSelect.innerHTML = '<option value="">Choose a sermon...</option>';
            sermons
                .sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated))
                .forEach(sermon => {
                    const option = document.createElement('option');
                    option.value = sermon.id;
                    option.textContent = `${sermon.title} - ${sermon.speaker} (${sermon.dateFormatted})`;
                    sermonSelect.appendChild(option);
                });
        }

        function loadSermonsForStudy() {
            const sermons = getSermons();
            const studySermonSelect = document.getElementById('studySermonSelect');
            
            if (!studySermonSelect) return;
            
            studySermonSelect.innerHTML = '<option value="">Choose a sermon...</option>';
            sermons
                .sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated))
                .forEach(sermon => {
                    const option = document.createElement('option');
                    option.value = sermon.id;
                    option.textContent = `${sermon.title} - ${sermon.speaker} (${sermon.dateFormatted})`;
                    studySermonSelect.appendChild(option);
                });
        }

        function selectSermon() {
            const sermonSelect = document.getElementById('sermonSelect');
            const selectedSermonDiv = document.getElementById('selectedSermon');
            const sermonTitle = document.getElementById('sermonTitle');
            const sermonSummary = document.getElementById('sermonSummary');
            
            if (!sermonSelect || !selectedSermonDiv) return;
            
            const sermonId = sermonSelect.value;
            if (!sermonId) {
                selectedSermonDiv.style.display = 'none';
                return;
            }
            
            const sermons = getSermons();
            const sermon = sermons.find(s => s.id === sermonId);
            
            if (sermon) {
                currentSermonData = sermon;
                sermonTitle.textContent = `${sermon.title} - ${sermon.speaker}`;
                sermonSummary.textContent = sermon.summary || 'No summary available';
                selectedSermonDiv.style.display = 'block';
                
                const chatHistory = document.getElementById('chatHistory');
                if (chatHistory) {
                    chatHistory.innerHTML = '';
                }
            }
        }

        async function askAI() {
            const sermonSelect = document.getElementById('sermonSelect');
            const questionInput = document.getElementById('question');
            const chatHistory = document.getElementById('chatHistory');
            
            if (!sermonSelect || !questionInput || !chatHistory) return;
            
            const sermonId = sermonSelect.value;
            const question = questionInput.value.trim();
            
            if (!sermonId) {
                showStatus('Please select a sermon first', 'error');
                return;
            }
            
            if (!question) {
                showStatus('Please enter a question', 'error');
                return;
            }
            
            const sermons = getSermons();
            const sermon = sermons.find(s => s.id === sermonId);
            
            if (!sermon) {
                showStatus('Sermon not found', 'error');
                return;
            }
            
            addChatMessage(question, 'user');
            questionInput.value = '';
            
            const thinkingMessage = addChatMessage('AI is thinking...', 'ai', true);
            
            try {
                await delay(1500);
                
                const aiResponse = aiEngine.generateResponse(question, sermon);
                thinkingMessage.textContent = aiResponse;
                thinkingMessage.classList.remove('thinking');
                
            } catch (error) {
                thinkingMessage.textContent = 'Sorry, I encountered an error. Please try again.';
                thinkingMessage.classList.remove('thinking');
            }
            
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function addChatMessage(content, type, isThinking = false) {
            const chatHistory = document.getElementById('chatHistory');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message chat-${type}`;
            
            if (isThinking) {
                messageDiv.classList.add('thinking');
            }
            
            messageDiv.textContent = content;
            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
            
            return messageDiv;
        }

        async function generateStudy() {
            const studySermonSelect = document.getElementById('studySermonSelect');
            const studyDuration = document.getElementById('studyDuration');
            const studyType = document.getElementById('studyType');
            const studyContent = document.getElementById('studyContent');
            
            if (!studySermonSelect || !studyContent) return;
            
            const sermonId = studySermonSelect.value;
            const duration = studyDuration?.value || '7';
            const type = studyType?.value || 'personal';
            
            if (!sermonId) {
                showStatus('Please select a sermon first', 'error');
                return;
            }
            
            const sermons = getSermons();
            const sermon = sermons.find(s => s.id === sermonId);
            
            if (!sermon) {
                showStatus('Sermon not found', 'error');
                return;
            }
            
            studyContent.innerHTML = '<div style="text-align: center; padding: 40px;">ü§ñ Generating personalized Bible study plan...</div>';
            updateAIStatus('Creating study plan...');
            
            try {
                await delay(3000);
                
                const studyPlan = generateStudyPlan(sermon, duration, type);
                studyContent.innerHTML = studyPlan;
                
                showStatus('Bible study generated successfully!', 'success');
                updateAIStatus('Study plan ready!', 'success');
                
            } catch (error) {
                studyContent.innerHTML = '<div style="color: var(--error); text-align: center; padding: 40px;">Error generating study plan. Please try again.</div>';
            }
        }

        function generateStudyPlan(sermon, duration, type) {
            const days = parseInt(duration);
            
            let studyPlan = `
                <div class="study-section">
                    <h3>üìñ ${days}-Day Bible Study: "${sermon.title}"</h3>
                    <div class="sermon-meta">
                        <span>üé§ Based on sermon by ${sermon.speaker}</span>
                        <span>üìÖ ${sermon.dateFormatted}</span>
                        <span>üë• ${type.charAt(0).toUpperCase() + type.slice(1)} Study</span>
                    </div>
                </div>
            `;
            
            for (let day = 1; day <= Math.min(days, 7); day++) {
                studyPlan += generateStudyDay(day, sermon, type);
            }
            
            if (days > 7) {
                studyPlan += `
                    <div class="glass-card">
                        <p style="text-align: center; color: var(--text-secondary);">
                            This is a preview of your ${days}-day study. The complete study plan would continue with deeper exploration of the sermon themes.
                        </p>
                    </div>
                `;
            }
            
            return studyPlan;
        }

        function generateStudyDay(day, sermon, type) {
            const themes = [
                { title: 'Foundation in Faith', scripture: 'Romans 8:28' },
                { title: 'Growing Deeper', scripture: 'Philippians 4:13' },
                { title: 'Living It Out', scripture: 'James 2:17' },
                { title: 'Sharing with Others', scripture: 'Matthew 28:19-20' },
                { title: 'Overcoming Challenges', scripture: '1 Corinthians 10:13' },
                { title: 'Prayer and Worship', scripture: '1 Thessalonians 5:16-18' },
                { title: 'Walking Forward', scripture: 'Philippians 3:13-14' }
            ];
            
            const theme = themes[(day - 1) % themes.length];
            
            return `
                <div class="study-day">
                    <h4>Day ${day}: ${theme.title}</h4>
                    
                    <div style="margin: 15px 0;">
                        <strong>üìñ Scripture Reading:</strong> ${theme.scripture}
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <strong>üí≠ Reflection Questions:</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>How does today's scripture relate to the sermon message?</li>
                            <li>What stood out to you most from this teaching?</li>
                            <li>How can you apply this truth to your current situation?</li>
                        </ul>
                    </div>
                    
                    <div style="margin: 15px 0; padding: 15px; background: rgba(124, 58, 237, 0.05); border-radius: 12px;">
                        <strong>‚ö° Daily Action:</strong><br>
                        Spend 15 minutes in prayer reflecting on how God wants you to grow in this area.
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <strong>üôè Prayer Focus:</strong> Ask God to help you understand and apply His Word in your daily life.
                    </div>
                </div>
            `;
        }

        function updateAnalytics() {
            const sermons = getSermons();
            
            const totalSermons = sermons.length;
            const totalWords = sermons.reduce((sum, sermon) => {
                return sum + (sermon.transcript ? sermon.transcript.split(' ').length : 0);
            }, 0);
            
            const totalMinutes = sermons.reduce((sum, sermon) => {
                const analysis = sermon.analysis || {};
                return sum + (analysis.estimatedDuration || 0);
            }, 0);
            
            const avgLength = totalSermons > 0 ? Math.round(totalMinutes / totalSermons) : 0;
            const totalHours = Math.round(totalMinutes / 60 * 10) / 10;
            
            const allTopics = [];
            const allScriptures = [];
            
            sermons.forEach(sermon => {
                if (sermon.tags) allTopics.push(...sermon.tags);
                if (sermon.analysis?.scriptures) allScriptures.push(...sermon.analysis.scriptures);
            });
            
            const uniqueTopics = [...new Set(allTopics)].length;
            const uniqueScriptures = [...new Set(allScriptures)].length;
            
            updateElement('totalSermons', totalSermons);
            updateElement('totalHours', totalHours);
            updateElement('avgLength', avgLength);
            updateElement('topicsCount', uniqueTopics);
            updateElement('scriptureCount', uniqueScriptures);
            updateElement('wordsCount', totalWords.toLocaleString());
            updateElement('studiesGenerated', StorageManager.load('studies', []).length);
        }

        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        function exportSermon(sermonId, format) {
            const sermons = getSermons();
            const sermon = sermons.find(s => s.id === sermonId);
            
            if (!sermon) {
                showStatus('Sermon not found', 'error');
                return;
            }
            
            const content = `${sermon.title}
Speaker: ${sermon.speaker}
Date: ${sermon.dateFormatted}
${sermon.scripture ? `Scripture: ${sermon.scripture}` : ''}

SUMMARY:
${sermon.summary || 'No summary available'}

${sermon.keyPoints ? `KEY POINTS:\n${sermon.keyPoints}\n` : ''}

TRANSCRIPT:
${sermon.transcript}

${sermon.tags ? `TAGS: ${sermon.tags.join(', ')}` : ''}

---
Generated by Vision United Worship Center
${new Date().toLocaleDateString()}`;
            
            downloadFile(`${sermon.title}.txt`, content, 'text/plain');
            showStatus('Sermon exported successfully!', 'success');
        }

        function shareSermon(sermonId) {
            const sermons = getSermons();
            const sermon = sermons.find(s => s.id === sermonId);
            
            if (!sermon) {
                showStatus('Sermon not found', 'error');
                return;
            }
            
            const shareText = `Check out this sermon: "${sermon.title}" by ${sermon.speaker}\n\n${sermon.summary || 'Great message about faith and life!'}`;
            
            if (navigator.share) {
                navigator.share({
                    title: sermon.title,
                    text: shareText,
                    url: window.location.href
                });
            } else if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText);
                showStatus('Sermon details copied to clipboard!', 'success');
            } else {
                showStatus('Sharing not supported', 'warning');
            }
        }

        function deleteSermon(sermonId) {
            if (!confirm('Are you sure you want to delete this sermon? This action cannot be undone.')) {
                return;
            }
            
            const sermons = getSermons();
            const filteredSermons = sermons.filter(s => s.id !== sermonId);
            
            if (StorageManager.save('sermons', filteredSermons)) {
                loadSermons();
                loadSermonsForQA();
                loadSermonsForStudy();
                updateAnalytics<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision United Worship Center</title>
    <meta name="description" content="AI-Powered Sermon Management & Study Center">
    <meta name="theme-color" content="#7c3aed">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
    
    <style>
        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --secondary: #059669;
            --accent: #f59e0b;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --background: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #667eea 50%, #f093fb 75%, #667eea 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .app-container {
            min-height: 100vh;
            backdrop-filter: blur(20px);
        }

        .header {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.95), rgba(5, 150, 105, 0.95));
            backdrop-filter: blur(20px);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(124, 58, 237, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header h1 {
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .ai-status {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(16, 185, 129, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: pulse 2s infinite;
        }

        .ai-status::before {
            content: 'ü§ñ';
            margin-right: 8px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 20px var(--shadow);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            background: transparent;
            color: var(--text-secondary);
            padding: 18px 12px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.4s ease;
            border-bottom: 3px solid transparent;
            min-height: 60px;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
            min-width: 100px;
        }

        .nav-tab::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(124, 58, 237, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .nav-tab:hover::after {
            left: 100%;
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.05), rgba(5, 150, 105, 0.05));
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.2);
        }

        .nav-tab-icon {
            display: block;
            font-size: 1.4em;
            margin-bottom: 4px;
        }

        .tab-content {
            padding: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .tab {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .tab.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }

        .form-group {
            margin: 25px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--text);
            font-size: 1.1em;
        }

        input, textarea, select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border);
            border-radius: 16px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            min-height: 56px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1);
            transform: translateY(-2px);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--primary));
            color: white;
            padding: 16px 24px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            font-family: inherit;
            transition: all 0.4s ease;
            width: 100%;
            margin: 12px 0;
            position: relative;
            overflow: hidden;
            min-height: 56px;
            box-shadow: 0 4px 20px rgba(124, 58, 237, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(124, 58, 237, 0.4);
        }

        .btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn-icon {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--text-secondary), var(--secondary));
            margin: 5px 0;
        }

        .btn-export {
            background: linear-gradient(135deg, var(--success), var(--info));
            margin: 5px;
            width: calc(50% - 10px);
            display: inline-block;
        }

        .recording-section {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(251, 146, 60, 0.1));
            border: 2px solid rgba(239, 68, 68, 0.2);
        }

        .recording-section.recording {
            animation: recordingGlow 2s infinite;
        }

        @keyframes recordingGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 0 50px rgba(239, 68, 68, 0.6); }
        }

        .youtube-section {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
            border: 2px solid rgba(251, 191, 36, 0.3);
        }

        .audio-upload-section {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .transcription-method {
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
        }

        .transcription-method:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(124, 58, 237, 0.15);
        }

        .transcription-method.selected {
            border-color: var(--primary);
            background: rgba(124, 58, 237, 0.05);
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.2);
        }

        .method-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 700;
            margin-left: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-instant {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            animation: pulse 2s infinite;
        }

        .badge-free {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .badge-premium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .processing-status {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            display: none;
        }

        .processing-status.show {
            display: block;
            animation: slideInUp 0.5s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            height: 12px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .sermon-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .sermon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(124, 58, 237, 0.2);
        }

        .sermon-title {
            color: var(--primary);
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .sermon-meta {
            color: var(--text-secondary);
            font-size: 0.95em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .chat-message {
            margin: 15px 0;
            padding: 16px 20px;
            border-radius: 20px;
            line-height: 1.6;
            animation: messageSlideIn 0.5s ease;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-user {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            margin-left: 60px;
            border-bottom-right-radius: 8px;
        }

        .chat-ai {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(5, 150, 105, 0.1));
            border: 1px solid rgba(124, 58, 237, 0.2);
            margin-right: 60px;
            border-bottom-left-radius: 8px;
            position: relative;
        }

        .chat-ai::before {
            content: 'ü§ñ';
            position: absolute;
            left: -40px;
            top: 16px;
            font-size: 1.5em;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-chat-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .file-upload {
            border: 3px dashed var(--border);
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
        }

        .file-upload:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.2);
        }

        .file-upload.dragover {
            border-color: var(--primary);
            background: rgba(124, 58, 237, 0.05);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-message {
            padding: 16px 20px;
            border-radius: 16px;
            margin: 20px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: statusSlideIn 0.5s ease;
        }

        @keyframes statusSlideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .status-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            color: var(--secondary);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            color: #991b1b;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(29, 78, 216, 0.1));
            color: #1e40af;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            color: #92400e;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .divider {
            text-align: center;
            margin: 30px 0;
            color: var(--text-secondary);
            font-weight: 700;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--border), transparent);
        }

        .divider span {
            background: var(--background);
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(124, 58, 237, 0.6);
        }

        .voice-command {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .voice-command.listening {
            animation: voicePulse 1s infinite;
            background: linear-gradient(135deg, #10b981, #059669);
        }

        @keyframes voicePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .audio-visualizer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            margin: 20px 0;
            height: 40px;
        }

        .audio-bar {
            width: 4px;
            background: linear-gradient(to top, var(--primary), var(--secondary));
            border-radius: 2px;
            animation: audioWave 1s infinite ease-in-out;
        }

        .audio-bar:nth-child(odd) { animation-delay: 0.1s; }
        .audio-bar:nth-child(even) { animation-delay: 0.2s; }

        @keyframes audioWave {
            0%, 100% { height: 10px; }
            50% { height: 30px; }
        }

        .suggestion-chip {
            display: inline-block;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(5, 150, 105, 0.1));
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(124, 58, 237, 0.2);
        }

        .suggestion-chip:hover {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            transform: translateY(-2px);
        }

        .study-section {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(5, 150, 105, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-left: 4px solid var(--secondary);
        }

        .study-day {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin: 15px 0;
            border-left: 3px solid var(--secondary);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .study-day:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(5, 150, 105, 0.15);
        }

        .analytics-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .analytics-number {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sermon-analytics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .ai-status {
                position: static;
                margin: 10px auto 0;
                display: inline-block;
            }

            .nav-tab {
                padding: 15px 8px;
                font-size: 0.8em;
                min-height: 60px;
            }

            .tab-content {
                padding: 20px 15px;
            }

            .chat-user {
                margin-left: 20px;
            }

            .chat-ai {
                margin-right: 20px;
            }

            .btn-export {
                width: 100%;
                margin: 5px 0;
            }

            .floating-action {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }

            .voice-command {
                bottom: 80px;
                right: 20px;
                width: 45px;
                height: 45px;
            }

            .sermon-analytics {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .nav-tab {
                font-size: 0.75em;
                padding: 12px 6px;
            }

            .tab-content {
                padding: 15px 10px;
            }

            .glass-card {
                padding: 20px 15px;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --background: #0f172a;
                --surface: #1e293b;
                --text: #f1f5f9;
                --text-secondary: #94a3b8;
                --border: #334155;
            }

            body {
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #1e293b 75%, #0f172a 100%);
            }

            .glass-card {
                background: rgba(30, 41, 59, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            input, textarea, select {
                background: rgba(30, 41, 59, 0.8);
                color: var(--text);
                border-color: var(--border);
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="ai-status" id="aiStatus">AI Ready</div>
            <h1>Vision United Worship Center</h1>
            <p>AI-Powered Sermon Management & Study Center</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="1">
                <span class="nav-tab-icon">üìù</span>
                Add Sermon
            </button>
            <button class="nav-tab" data-tab="2">
                <span class="nav-tab-icon">üìö</span>
                View Sermons
            </button>
            <button class="nav-tab" data-tab="3">
                <span class="nav-tab-icon">ü§ñ</span>
                AI Q&A
            </button>
            <button class="nav-tab" data-tab="4">
                <span class="nav-tab-icon">üìñ</span>
                Study Plans
            </button>
            <button class="nav-tab" data-tab="5">
                <span class="nav-tab-icon">üìä</span>
                Analytics
            </button>
        </div>

        <div class="tab-content">
            <!-- Add Sermon Tab -->
            <div id="tab1" class="tab active">
                <div class="glass-card">
                    <div class="form-group">
                        <label>üìã Sermon Title *</label>
                        <input type="text" id="title" placeholder="Enter sermon title..." required>
                        <div id="titleFeedback"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>üë§ Speaker</label>
                        <input type="text" id="speaker" placeholder="Pastor name...">
                    </div>

                    <div class="form-group">
                        <label>üìÖ Date</label>
                        <input type="date" id="sermonDate">
                    </div>

                    <div class="form-group">
                        <label>üìñ Scripture Reference</label>
                        <input type="text" id="scripture" placeholder="e.g., John 3:16, Romans 8:28">
                    </div>
                </div>

                <!-- Live Recording Section -->
                <div class="glass-card recording-section" id="recordingCard">
                    <h3>üé§ Live Recording</h3>
                    <button class="btn" id="recordBtn">
                        <span class="btn-icon">üé§</span>
                        Start Recording
                    </button>
                    <button class="btn btn-secondary" id="stopBtn" style="display: none;">
                        <span class="btn-icon">‚èπÔ∏è</span>
                        Stop Recording
                    </button>
                    <div id="recordStatus"></div>
                    <div class="audio-visualizer" id="audioVisualizer" style="display: none;">
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                    </div>
                    <audio id="audioPlayer" controls style="display: none;"></audio>
                </div>
                
                <div class="divider"><span>OR</span></div>
                
                <!-- YouTube Processing Section -->
                <div class="glass-card youtube-section">
                    <h3>üì∫ YouTube Video Processing</h3>
                    <div class="form-group">
                        <input type="url" id="youtube" placeholder="Paste YouTube URL here...">
                    </div>
                    
                    <div class="transcription-method selected" data-method="captions">
                        <strong>üöÄ Instant Caption Extraction</strong>
                        <span class="method-badge badge-instant">INSTANT</span>
                        <span class="method-badge badge-free">FREE</span>
                        <p style="margin-top: 12px; color: var(--text-secondary);">Extract existing YouTube captions instantly</p>
                    </div>
                    
                    <div class="transcription-method" data-method="audio">
                        <strong>üéµ AI Audio Transcription</strong>
                        <span class="method-badge badge-free">FREE</span>
                        <p style="margin-top: 12px; color: var(--text-secondary);">Advanced speech-to-text processing</p>
                    </div>
                    
                    <div class="transcription-method" data-method="premium">
                        <strong>‚≠ê Premium AI Transcription</strong>
                        <span class="method-badge badge-premium">PREMIUM</span>
                        <p style="margin-top: 12px; color: var(--text-secondary);">Highest quality with speaker identification</p>
                    </div>
                    
                    <button class="btn" id="youtubeBtn">
                        <span class="btn-icon">üì∫</span>
                        Process YouTube Video
                    </button>
                    
                    <div id="processingStatus" class="processing-status">
                        <div id="processingMessage">Processing...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div id="processingDetails"></div>
                    </div>
                </div>
                
                <div class="divider"><span>OR</span></div>
                
                <!-- Audio File Upload Section -->
                <div class="glass-card audio-upload-section">
                    <h3>üéµ Upload Audio File</h3>
                    <div class="file-upload" id="audioUpload">
                        <span class="upload-icon">üìÅ</span>
                        <p><strong>Drag & drop audio file here</strong></p>
                        <p style="color: var(--text-secondary); margin-top: 8px;">Supports MP3, WAV, M4A, OGG, FLAC</p>
                        <input type="file" id="audioFile" accept="audio/*" style="display: none;">
                    </div>
                    <button class="btn" id="processAudioBtn" style="display: none;">
                        <span class="btn-icon">üéµ</span>
                        Transcribe Audio
                    </button>
                </div>
                
                <div class="glass-card">
                    <div class="form-group">
                        <label>üìù Transcript</label>
                        <textarea id="transcript" rows="6" placeholder="Transcription will appear here or enter manually..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>ü§ñ AI Summary</label>
                        <textarea id="summary" rows="4" readonly style="background: rgba(0,0,0,0.05);" placeholder="AI summary will appear here..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>üéØ Key Points</label>
                        <textarea id="keyPoints" rows="3" placeholder="Key sermon points..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>üè∑Ô∏è Tags</label>
                        <input type="text" id="tags" placeholder="faith, hope, community, salvation...">
                    </div>
                    
                    <button class="btn" id="saveBtn">
                        <span class="btn-icon">üíæ</span>
                        Save Sermon
                    </button>
                    <div id="status"></div>
                </div>
            </div>
            
            <!-- View Sermons Tab -->
            <div id="tab2" class="tab">
                <div class="glass-card">
                    <h2>üìö Saved Sermons</h2>
                    <div class="sermon-analytics" id="sermonStats">
                        <div class="analytics-card">
                            <div class="analytics-number" id="totalSermons">0</div>
                            <div>Total Sermons</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-number" id="totalHours">0</div>
                            <div>Hours of Content</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-number" id="avgLength">0</div>
                            <div>Avg Length (min)</div>
                        </div>
                    </div>
                </div>
                <div id="sermonList"></div>
            </div>
            
            <!-- AI Q&A Tab -->
            <div id="tab3" class="tab">
                <div class="glass-card">
                    <h2>ü§ñ AI Sermon Q&A</h2>
                    <div class="form-group">
                        <label>üìö Select Sermon</label>
                        <select id="sermonSelect">
                            <option value="">Choose a sermon...</option>
                        </select>
                    </div>
                    
                    <div id="selectedSermon" class="glass-card" style="display: none;">
                        <h3 id="sermonTitle"></h3>
                        <p id="sermonSummary"></p>
                        <div style="margin-top: 15px;">
                            <strong>üí° Quick Questions:</strong>
                            <div class="suggestion-chip" onclick="askQuickQuestion('What was the main message?')">What was the main message?</div>
                            <div class="suggestion-chip" onclick="askQuickQuestion('What scripture was referenced?')">What scripture was referenced?</div>
                            <div class="suggestion-chip" onclick="askQuickQuestion('How can I apply this?')">How can I apply this?</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>üí¨ Ask AI about this sermon</label>
                        <input type="text" id="question" placeholder="Ask anything about the sermon...">
                        <button class="btn" id="askBtn">
                            <span class="btn-icon">ü§ñ</span>
                            Ask AI
                        </button>
                    </div>
                    
                    <div id="chatHistory" class="ai-chat-container"></div>
                </div>
            </div>
            
            <!-- Study Plans Tab -->
            <div id="tab4" class="tab">
                <div class="glass-card">
                    <h2>üìñ Follow-Up Bible Study</h2>
                    <div class="form-group">
                        <label>üìö Select Sermon for Study</label>
                        <select id="studySermonSelect">
                            <option value="">Choose a sermon...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>üìÖ Study Duration</label>
                        <select id="studyDuration">
                            <option value="7">7-Day Study</option>
                            <option value="14">14-Day Deep Dive</option>
                            <option value="30">30-Day Journey</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>üë• Study Type</label>
                        <select id="studyType">
                            <option value="personal">Personal Study</option>
                            <option value="group">Small Group Study</option>
                            <option value="family">Family Devotions</option>
                        </select>
                    </div>
                    
                    <button class="btn" id="generateStudyBtn">
                        <span class="btn-icon">üìñ</span>
                        Generate AI Bible Study
                    </button>
                    
                    <div id="studyContent"></div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="tab5" class="tab">
                <div class="glass-card">
                    <h2>üìä Sermon Analytics</h2>
                    <div id="analyticsContent">
                        <div class="sermon-analytics">
                            <div class="analytics-card">
                                <div class="analytics-number" id="topicsCount">0</div>
                                <div>Unique Topics</div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-number" id="scriptureCount">0</div>
                                <div>Scripture References</div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-number" id="wordsCount">0</div>
                                <div>Total Words</div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-number" id="studiesGenerated">0</div>
                                <div>Studies Generated</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <button class="floating-action" id="quickAddBtn" title="Quick Add Sermon">
        ‚ûï
    </button>

    <button class="voice-command" id="voiceBtn" title="Voice Commands">
        üé§
    </button>

    <script>
        // Global Variables
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let recordingStartTime = 0;
        let recordingTimer = null;
        let selectedTranscriptionMethod = 'captions';
        let currentAudioFile = null;
        let currentSermonData = null;
        let voiceRecognition = null;
        let isListening = false;

        // AI Engine Class
        class AIEngine {
            constructor() {
                this.patterns = {
                    scriptureRef: /\b\d*\s*[A-Z][a-z]+\s+\d+:\d+(-\d+)?\b/g,
                    topics: ['faith', 'hope', 'love', 'salvation', 'prayer', 'forgiveness', 'community', 'grace', 'mercy', 'worship'],
                    keyPhrases: ['the lord', 'god', 'jesus', 'christ', 'holy spirit', 'scripture', 'bible', 'gospel']
                };
            }

            analyzeSermon(content) {
                return {
                    wordCount: content.split(' ').length,
                    scriptures: this.extractScriptures(content),
                    topics: this.identifyTopics(content),
                    sentiment: this.analyzeSentiment(content),
                    estimatedDuration: Math.ceil(content.split(' ').length / 150)
                };
            }

            extractScriptures(content) {
                const matches = content.match(this.patterns.scriptureRef) || [];
                return [...new Set(matches)];
            }

            identifyTopics(content) {
                const lowerContent = content.toLowerCase();
                return this.patterns.topics.filter(topic => lowerContent.includes(topic));
            }

            analyzeSentiment(content) {
                const positiveWords = ['love', 'hope', 'joy', 'peace', 'blessing', 'grace'];
                const negativeWords = ['sin', 'death', 'fear', 'worry', 'doubt'];
                
                const words = content.toLowerCase().split(' ');
                const positive = words.filter(word => positiveWords.includes(word)).length;
                const negative = words.filter(word => negativeWords.includes(word)).length;
                
                if (positive > negative) return 'positive';
                if (negative > positive) return 'challenging';
                return 'balanced';
            }

            generateSummary(content) {
                const analysis = this.analyzeSermon(content);
                const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
                
                const keySentences = sentences
                    .sort((a, b) => b.length - a.length)
                    .slice(0, 3);

                return {
                    summary: `This sermon focuses on ${analysis.topics.join(', ')} with a ${analysis.sentiment} tone. Key themes include spiritual growth and practical faith application.`,
                    keyPoints: keySentences,
                    scriptures: analysis.scriptures,
                    topics: analysis.topics,
                    duration: `${analysis.estimatedDuration} minutes`
                };
            }

            generateResponse(question, sermonData) {
                const lowerQuestion = question.toLowerCase();
                
                if (lowerQuestion.includes('main message') || lowerQuestion.includes('main point')) {
                    return `The main message of "${sermonData.title}" focuses on spiritual growth and practical faith application. The sermon emphasizes the importance of living out biblical principles in daily life.`;
                }
                
                if (lowerQuestion.includes('scripture') || lowerQuestion.includes('bible')) {
                    const scriptures = this.extractScriptures(sermonData.transcript);
                    if (scriptures.length > 0) {
                        return `This sermon references ${scriptures.slice(0, 3).join(', ')}. These passages support the main teaching about faith and spiritual growth.`;
                    }
                    return "I didn't find specific scripture references in this sermon transcript.";
                }
                
                if (lowerQuestion.includes('apply') || lowerQuestion.includes('practical')) {
                    return `Based on this sermon, you can apply these teachings by: practicing daily prayer and Bible reading, showing love and kindness to others, and actively participating in your faith community. The goal is to transform understanding into action.`;
                }
                
                return `That's a thoughtful question about "${sermonData.title}". The sermon emphasizes spiritual growth and encourages listeners to apply biblical principles in their daily lives. Would you like me to elaborate on any specific aspect?`;
            }
        }

        // Storage Manager Class
        class StorageManager {
            static save(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Storage error:', error);
                    return false;
                }
            }

            static load(key, defaultValue = null) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    console.error('Load error:', error);
                    return defaultValue;
                }
            }

            static remove(key) {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (error) {
                    return false;
                }
            }
        }

        // Initialize AI Engine
        const aiEngine = new AIEngine();

        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            setupVoiceCommands();
            loadSermons();
            loadSermonsForQA();
            loadSermonsForStudy();
            updateAnalytics();
            setupFileUpload();
            updateAIStatus('System ready!');
            
            // Set default date
            document.getElementById('sermonDate').value = new Date().toISOString().split('T')[0];
        }

        // Initialize form validation and auto-save
        function setupFormValidation() {
            const titleInput = document.getElementById('title');
            const titleFeedback = document.getElementById('titleFeedback');
            
            if (titleInput && titleFeedback) {
                titleInput.addEventListener('blur', function() {
                    validateTitle(this, titleFeedback);
                });
                
                titleInput.addEventListener('input', function() {
                    if (this.value.length > 0) {
                        validateTitle(this, titleFeedback);
                    }
                });
            }

            // Setup auto-save
            setupAutoSave();
        }

        function validateTitle(input, feedback) {
            const value = input.value.trim();
            
            if (value === '') {
                feedback.textContent = 'Title is required';
                feedback.className = 'status-error';
                input.style.borderColor = 'var(--error)';
            } else if (value.length < 3) {
                feedback.textContent = 'Title must be at least 3 characters';
                feedback.className = 'status-warning';
                input.style.borderColor = 'var(--warning)';
            } else {
                feedback.textContent = '‚úì Title looks good!';
                feedback.className = 'status-success';
                input.style.borderColor = 'var(--success)';
            }
        }

        function setupAutoSave() {
            let autoSaveTimer;
            const inputs = ['title', 'speaker', 'scripture', 'transcript', 'keyPoints', 'tags'];
            
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', function() {
                        clearTimeout(autoSaveTimer);
                        autoSaveTimer = setTimeout(saveDraft, 3000);
                    });
                }
            });
        }

        function saveDraft() {
            const draft = {
                title: document.getElementById('title').value,
                speaker: document.getElementById('speaker').value,
                scripture: document.getElementById('scripture').value,
                transcript: document.getElementById('transcript').value,
                keyPoints: document.getElementById('keyPoints').value,
                tags: document.getElementById('tags').value,
                timestamp: Date.now()
            };
            
            if (Object.values(draft).some(value => value && value.toString().trim())) {
                StorageManager.save('sermonDraft', draft);
                updateAIStatus('Draft auto-saved', 'success');
            }
        }

        function loadDraft() {
            const draft = StorageManager.load('sermonDraft');
            if (draft && draft.timestamp) {
                const hoursOld = (Date.now() - draft.timestamp) / (1000 * 60 * 60);
                
                if (hoursOld < 24) {
                    const fields = ['title', 'speaker', 'scripture', 'transcript', 'keyPoints', 'tags'];
                    fields.forEach(field => {
                        const element = document.getElementById(field);
                        if (element && draft[field]) {
                            element.value = draft[field];
                        }
                    });
                    showStatus('Draft loaded from previous session', 'info');
                }
            }
        }
            // Tab navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabNumber = this.getAttribute('data-tab');
                    switchTab(tabNumber);
                    updateAIStatus(`Switched to ${this.textContent.trim()}`);
                });
            });

            // Buttons
            document.getElementById('recordBtn')?.addEventListener('click', startRecording);
            document.getElementById('stopBtn')?.addEventListener('click', stopRecording);
            document.getElementById('youtubeBtn')?.addEventListener('click', processYouTubeVideo);
            document.getElementById('processAudioBtn')?.addEventListener('click', processAudioFile);
            document.getElementById('saveBtn')?.addEventListener('click', saveSermon);
            document.getElementById('askBtn')?.addEventListener('click', askAI);
            document.getElementById('generateStudyBtn')?.addEventListener('click', generateStudy);
            
            // Sermon selection
            document.getElementById('sermonSelect')?.addEventListener('change', selectSermon);

            // Transcription methods
            document.querySelectorAll('.transcription-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.transcription-method').forEach(m => m.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedTranscriptionMethod = this.getAttribute('data-method');
                });
            });

            // Question input
            document.getElementById('question')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    askAI();
                }
            });

            // Floating buttons
            document.getElementById('quickAddBtn')?.addEventListener('click', function() {
                switchTab('1');
                document.getElementById('title').focus();
            });

            document.getElementById('voiceBtn')?.addEventListener('click', toggleVoiceCommands);

            // Auto-generate summary
            document.getElementById('transcript')?.addEventListener('input', debounce(function() {
                if (this.value.length > 100) {
                    generateAISummary(this.value);
                }
            }, 2000));

            // Setup file upload after DOM elements are ready
            setTimeout(setupFileUpload, 100);
        }

        function setupVoiceCommands() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                voiceRecognition = new SpeechRecognition();
                voiceRecognition.continuous = false;
                voiceRecognition.interimResults = false;
                voiceRecognition.lang = 'en-US';

                voiceRecognition.onresult = function(event) {
                    const command = event.results[0][0].transcript.toLowerCase();
                    processVoiceCommand(command);
                };

                voiceRecognition.onerror = function() {
                    isListening = false;
                    updateVoiceButton();
                };

                voiceRecognition.onend = function() {
                    isListening = false;
                    updateVoiceButton();
                };
            }
        }

        function toggleVoiceCommands() {
            if (!voiceRecognition) {
                showStatus('Voice commands not supported', 'warning');
                return;
            }

            if (isListening) {
                voiceRecognition.stop();
                isListening = false;
            } else {
                voiceRecognition.start();
                isListening = true;
            }
            updateVoiceButton();
        }

        function updateVoiceButton() {
            const voiceBtn = document.getElementById('voiceBtn');
            if (voiceBtn) {
                if (isListening) {
                    voiceBtn.classList.add('listening');
                    voiceBtn.textContent = 'üî¥';
                } else {
                    voiceBtn.classList.remove('listening');
                    voiceBtn.textContent = 'üé§';
                }
            }
        }

        function processVoiceCommand(command) {
            if (command.includes('new sermon')) {
                switchTab('1');
            } else if (command.includes('view sermons')) {
                switchTab('2');
            } else if (command.includes('ask ai')) {
                switchTab('3');
            } else if (command.includes('study')) {
                switchTab('4');
            } else if (command.includes('analytics')) {
                switchTab('5');
            } else if (command.includes('start recording')) {
                startRecording();
            } else if (command.includes('stop recording')) {
                stopRecording();
            }
        }

        function setupFileUpload() {
            const uploadArea = document.getElementById('audioUpload');
            const fileInput = document.getElementById('audioFile');
            
            uploadArea?.addEventListener('click', () => fileInput.click());
            
            uploadArea?.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea?.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea?.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type.startsWith('audio/')) {
                    handleAudioFile(files[0]);
                }
            });
            
            fileInput?.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleAudioFile(e.target.files[0]);
                }
            });
        }

        function handleAudioFile(file) {
            currentAudioFile = file;
            const uploadArea = document.getElementById('audioUpload');
            const processBtn = document.getElementById('processAudioBtn');
            
            if (uploadArea && processBtn) {
                uploadArea.innerHTML = `
                    <span class="upload-icon">üìÅ</span>
                    <p><strong>${file.name}</strong></p>
                    <p style="color: var(--text-secondary);">Size: ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                `;
                processBtn.style.display = 'block';
            }
        }

        function switchTab(tabNumber) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            const selectedTab = document.getElementById(`tab${tabNumber}`);
            const selectedNavTab = document.querySelector(`[data-tab="${tabNumber}"]`);
            
            if (selectedTab) selectedTab.classList.add('active');
            if (selectedNavTab) selectedNavTab.classList.add('active');
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audioPlayer = document.getElementById('audioPlayer');
                    if (audioPlayer) {
                        audioPlayer.src = audioUrl;
                        audioPlayer.style.display = 'block';
                    }
                    
                    transcribeAudio();
                    stream.getTracks().forEach(track => track.stop());
                };
                
                mediaRecorder.start();
                isRecording = true;
                recordingStartTime = Date.now();
                
                updateRecordingUI(true);
                startRecordingTimer();
                updateAIStatus('Recording...');
                
            } catch (error) {
                showStatus('Error accessing microphone', 'error');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                
                updateRecordingUI(false);
                
                if (recordingTimer) {
                    clearInterval(recordingTimer);
                    recordingTimer = null;
                }
                
                updateAIStatus('Recording complete!');
            }
        }

        function updateRecordingUI(recording) {
            const recordBtn = document.getElementById('recordBtn');
            const stopBtn = document.getElementById('stopBtn');
            const recordStatus = document.getElementById('recordStatus');
            const recordingCard = document.getElementById('recordingCard');
            const visualizer = document.getElementById('audioVisualizer');
            
            if (recording) {
                recordBtn.style.display = 'none';
                stopBtn.style.display = 'block';
                recordStatus.textContent = 'Recording...';
                recordingCard.classList.add('recording');
                visualizer.style.display = 'flex';
            } else {
                recordBtn.style.display = 'block';
                stopBtn.style.display = 'none';
                recordStatus.textContent = 'Recording complete!';
                recordingCard.classList.remove('recording');
                visualizer.style.display = 'none';
            }
        }

        function startRecordingTimer() {
            recordingTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                const recordStatus = document.getElementById('recordStatus');
                if (recordStatus) {
                    recordStatus.textContent = `Recording... ${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        async function transcribeAudio() {
            updateAIStatus('Transcribing audio...');
            await delay(2000);
            
            const sampleText = `Welcome everyone! Today we're exploring the power of faith in our daily lives. 

            In Romans 8:28, we read that "all things work together for good for those who love God." This doesn't mean everything that happens is good, but that God can work through all circumstances.

            I want to share three key points about living by faith:

            First, faith isn't the absence of doubt - it's trusting God despite our questions. Even when we can't see the full picture, we can trust in God's character and promises.

            Second, faith requires action. James tells us that faith without works is dead. Our belief should translate into how we live, love, and serve others.

            Third, faith grows through community. When we surround ourselves with other believers, we're strengthened and encouraged in our journey.

            Let's pray together and ask God to strengthen our faith today.`;
            
            document.getElementById('transcript').value = sampleText;
            await generateAISummary(sampleText);
            showStatus('Audio transcribed successfully!', 'success');
        }

        async function processYouTubeVideo() {
            const youtubeUrl = document.getElementById('youtube').value.trim();
            if (!youtubeUrl) {
                showStatus('Please enter a YouTube URL', 'error');
                return;
            }
            
            const videoId = extractYouTubeVideoId(youtubeUrl);
            if (!videoId) {
                showStatus('Invalid YouTube URL',
